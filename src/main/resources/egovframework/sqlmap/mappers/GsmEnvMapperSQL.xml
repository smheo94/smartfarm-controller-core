<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kt.smartfarm.supervisor.mapper.GsmEnvMapper">


	<insert id="insert" parameterType="gsmEnvVO">
		INSERT INTO gsm_info (
			gsm_key,
			area_code, 
			farm_nickname, 
			system_host, 
			system_port, 		
			farm_nickname_i18n
		)
		VALUES (
			#{gsmKey}, 
			#{areaCode}, 
			#{farmNickname},
			#{systemHost}, 
			#{systemPort},		
			#{farmNicknameI18n}
		);
	</insert>
	
	<update id="update" parameterType="gsmEnvVO">
		UPDATE controller
		SET
		<if test="controller_info_id != null">controller_info_id = #{controllerInfoId},</if>
		,
		<if test="controller_type != null">controller_type = #{controllerType},</if>
		,
		<if test="ip != null">ip = #{ip},</if>
		,
		<if test="PORT != null">PORT = #{port},</if>
		,
		<if test="controller_status != null">controller_status = #{controllerStatus},</if>
		,
		<if test="description != null">description = #{description},</if>
		WHERE gsm_key = #{gsmKey} AND id = #{id};
	</update>
	
	<delete id="delete" >
		DELETE
		FROM gsm_info
		WHERE gsm_key = #{gsmKey};
	</delete>

	
	<select id="gsmOfDeviceList" resultType="map">
		/*gsmOfDeviceList*/
		SELECT
			gsm_info.gsm_key as gsmKey, gsm_info.user_info_id as userInfoId, is_mine as isMine, area_code as areaCode,
 			farm_nickname as farmNickname, gsm_info.update_date as updateDate, owner_user_info_id as ownerUserInfoId, master_system_host as masterSystemHost,
 			master_system_port as masterSystemPort, system_host as systemHost, system_port as systemPort, cropsurl, imsurl,
 			mqtt_broker_host as mqttbrokerHost, mqtt_broker_port as mqttBrokerPort, server_read_time as serverReadTime, product_interval as productInterval,
 			monitoring_interval as monitoringInterval, history_save_db_interval as historySaveDbInterval, sensor_current_retention_period as sensorCurrentRetentionPeriod,
 			debug_stop_event as debugStopEvent, debug_stop_crops as debugStopCrops, debug_stop_device_auto_control as debugStopDeviceAutoContorl, debug_stop_ims as debugStopIms,
 			delay_auto_control_start as delayAutoControlStart, package_version as packageVersion, schema_version as schemaVersion, nutrient_monitoring_interval as nutrientMonitoringInterval,
 			farm_nickname_i18n as farmNicknameI18n, user_id as userId, farm_db_id as farmDbId, category_id as categoryId, COUNT(device.id) AS deviceCount
		FROM gsm_info
		LEFT OUTER JOIN device ON gsm_info.gsm_key = device.gsm_key
		<where>
			<if test="gsmKey != null"> AND device.gsm_key = #{gsmKey}</if>
		</where>
		GROUP BY gsm_info.gsm_key;
	</select>
	
	<select id="get" resultType="gsmEnvVO" >
		/*get*/
		SELECT
			gsm_info.gsm_key as gsmKey, gsm_info.user_info_id as userInfoId, is_mine as isMine, area_code as areaCode,
 			farm_nickname as farmNickname, gsm_info.update_date as updateDate, owner_user_info_id as ownerUserInfoId, master_system_host as masterSystemHost,
 			master_system_port as masterSystemPort, system_host as systemHost, system_port as systemPort, cropsurl, imsurl,
 			mqtt_broker_host as mqttbrokerHost, mqtt_broker_port as mqttBrokerPort, server_read_time as serverReadTime, product_interval as productInterval,
 			monitoring_interval as monitoringInterval, history_save_db_interval as historySaveDbInterval, sensor_current_retention_period as sensorCurrentRetentionPeriod,
 			debug_stop_event as debugStopEvent, debug_stop_crops as debugStopCrops, debug_stop_device_auto_control as debugStopDeviceAutoContorl, debug_stop_ims as debugStopIms,
 			delay_auto_control_start as delayAutoControlStart, package_version as packageVersion, schema_version as schemaVersion, nutrient_monitoring_interval as nutrientMonitoringInterval,
 			farm_nickname_i18n as farmNicknameI18n, user_id as userId, farm_db_id as farmDbId, category_id as categoryId
		FROM gsm_info 
		WHERE 
			gsm_key = #{gsmKey}
	</select>

	<select id="getGsmList" resultType="map" >
		/*getGsmList*/
		SELECT
			gsm_info.gsm_key as gsmKey, gsm_info.user_info_id as userInfoId, is_mine as isMine, area_code as areaCode,
 			farm_nickname as farmNickname, gsm_info.update_date as updateDate, owner_user_info_id as ownerUserInfoId, master_system_host as masterSystemHost,
 			master_system_port as masterSystemPort, system_host as systemHost, system_port as systemPort, cropsurl, imsurl,
 			mqtt_broker_host as mqttbrokerHost, mqtt_broker_port as mqttBrokerPort, server_read_time as serverReadTime, product_interval as productInterval,
 			monitoring_interval as monitoringInterval, history_save_db_interval as historySaveDbInterval, sensor_current_retention_period as sensorCurrentRetentionPeriod,
 			debug_stop_event as debugStopEvent, debug_stop_crops as debugStopCrops, debug_stop_device_auto_control as debugStopDeviceAutoContorl, debug_stop_ims as debugStopIms,
 			delay_auto_control_start as delayAutoControlStart, package_version as packageVersion, schema_version as schemaVersion, nutrient_monitoring_interval as nutrientMonitoringInterval,
 			farm_nickname_i18n as farmNicknameI18n, user_id as userId, farm_db_id as farmDbId, category_id as categoryId
		FROM gsm_info
		<where>
			<if test="gsmKey != null"> AND gsm_info.gsm_key = #{gsmKey}</if>
		</where>
	</select>

	<select id="getHouseList" resultType="houseEnvVO">
		/*getHouseList*/
		SELECT 
			id, product_method_id, green_house_type_id, house_name,
			latitude, longitude, description, build_date, last_update, addr_1,
			addr_2, zip, nutrient_common_id, change_gh, change_temperature,
			floor_space, house_horizontal, house_vertical, house_height,
			plant_spacing, crop_cnt, house_direction, select_temp_sensor,
			select_hum_sensor, green_house.gsm_key, house_name_i18n
		FROM green_house
		INNER JOIN gsm_info ON green_house.gsm_key = gsm_info.gsm_key
		WHERE green_house.gsm_key = #{gsmKey}
	</select>
</mapper>
