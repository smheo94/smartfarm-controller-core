<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kt.smartfarm.supervisor.mapper.GsmEnvMapper">


	<insert id="insert" parameterType="gsmEnvVO">
		INSERT INTO gsm_info (
			gsm_key,
			area_code, 
			farm_nickname, 
			system_host, 
			system_port, 		
			farm_nickname_i18n
		)
		VALUES (
			#{gsmKey}, 
			#{areaCode}, 
			#{farmNickname},
			#{systemHost}, 
			#{systemPort},		
			#{farmNicknameI18n}
		);
	</insert>
	
	<update id="update" parameterType="gsmEnvVO">
	
		UPDATE gsm_info
		SET 
			<if test="gsm_key != null"> #{gsm_key},</if>
			<if test="user_info_id != null"> #{user_info_id},</if>
			<if test="is_mine != null"> #{is_mine},</if>
			<if test="area_code != null"> #{area_code},</if>
			<if test="farm_nickname != null"> #{farm_nickname},</if>
			<if test="update_date != null"> #{update_date},</if>
			<if test="owner_user_info_id != null"> #{owner_user_info_id},</if>
			<if test="master_system_host != null"> #{master_system_host},</if>
			<if test="master_system_port != null"> #{master_system_port},</if>
			<if test="system_host != null"> #{system_host},</if>
			<if test="system_port != null"> #{system_port},</if>
			<if test="vpn_system_host != null"> #{vpn_system_host},</if>
			<if test="vpn_system_port != null"> #{vpn_system_port},</if>
			<if test="cropsurl != null"> #{cropsurl},</if>
			<if test="imsurl != null"> #{imsurl},</if>
			<if test="mqtt_broker_host != null"> #{mqtt_broker_host},</if>
			<if test="mqtt_broker_port != null"> #{mqtt_broker_port},</if>
			<if test="server_read_time != null"> #{server_read_time},</if>
			<if test="product_interval != null"> #{product_interval},</if>
			<if test="monitoring_interval != null"> #{monitoring_interval},</if>
			<if test="history_save_db_interval != null"> #{history_save_db_interval},</if>
			<if test="sensor_current_retention_period != null"> #{sensor_current_retention_period},</if>
			<if test="debug_stop_event != null"> #{debug_stop_event},</if>
			<if test="debug_stop_crops != null"> #{debug_stop_crops},</if>
			<if test="debug_stop_device_auto_control != null"> #{debug_stop_device_auto_control},</if>
			<if test="debug_stop_ims != null"> #{debug_stop_ims},</if>
			<if test="delay_auto_control_start != null"> #{delay_auto_control_start},</if>
			<if test="package_version != null"> #{package_version},</if>
			<if test="schema_version != null"> #{schema_version},</if>
			<if test="nutrient_monitoring_interval != null"> #{nutrient_monitoring_interval},</if>
			<if test="farm_nickname_i18n != null"> #{farm_nickname_i18n},</if>
			<if test="user_id != null"> #{user_id},</if>
			<if test="farm_db_id != null"> #{farm_db_id},</if>
			<if test="category_id != null"> #{category_id},</if>
			<if test="monitoring_process_interval != null"> #{monitoring_process_interval}</if>
		WHERE gsm_key = #{gsm_key};
	</update>
	
	<delete id="delete" >
		DELETE
		FROM gsm_info
		WHERE gsm_key = #{gsmKey};
	</delete>

	
	<select id="gsmOfDeviceList" resultType="map">
		/*gsmOfDeviceList*/
		SELECT
			gsm_info.gsm_key as gsmKey, gsm_info.user_info_id as userInfoId, is_mine as isMine, area_code as areaCode,
 			farm_nickname as farmNickname, gsm_info.update_date as updateDate, owner_user_info_id as ownerUserInfoId, master_system_host as masterSystemHost,
 			master_system_port as masterSystemPort, system_host as systemHost, system_port as systemPort, cropsurl, imsurl,
 			mqtt_broker_host as mqttbrokerHost, mqtt_broker_port as mqttBrokerPort, server_read_time as serverReadTime, product_interval as productInterval,
 			monitoring_interval as monitoringInterval, history_save_db_interval as historySaveDbInterval, sensor_current_retention_period as sensorCurrentRetentionPeriod,
 			debug_stop_event as debugStopEvent, debug_stop_crops as debugStopCrops, debug_stop_device_auto_control as debugStopDeviceAutoContorl, debug_stop_ims as debugStopIms,
 			delay_auto_control_start as delayAutoControlStart, package_version as packageVersion, schema_version as schemaVersion, nutrient_monitoring_interval as nutrientMonitoringInterval,
 			farm_nickname_i18n as farmNicknameI18n, user_id as userId, farm_db_id as farmDbId, category_id as categoryId, COUNT(device.id) AS deviceCount
		FROM gsm_info
		LEFT OUTER JOIN device ON gsm_info.gsm_key = device.gsm_key
		<where>
			<if test="gsmKey != null"> AND device.gsm_key = #{gsmKey}</if>
		</where>
		GROUP BY gsm_info.gsm_key;
	</select>
	
	<select id="get" resultType="gsmEnvVO" >
		/*get*/
		SELECT
			gsm_info.gsm_key as gsmKey, gsm_info.user_info_id as userInfoId, is_mine as isMine, area_code as areaCode,
 			farm_nickname as farmNickname, gsm_info.update_date as updateDate, owner_user_info_id as ownerUserInfoId, master_system_host as masterSystemHost,
 			master_system_port as masterSystemPort, system_host as systemHost, system_port as systemPort, cropsurl, imsurl,
 			mqtt_broker_host as mqttbrokerHost, mqtt_broker_port as mqttBrokerPort, server_read_time as serverReadTime, product_interval as productInterval,
 			monitoring_interval as monitoringInterval, history_save_db_interval as historySaveDbInterval, sensor_current_retention_period as sensorCurrentRetentionPeriod,
 			debug_stop_event as debugStopEvent, debug_stop_crops as debugStopCrops, debug_stop_device_auto_control as debugStopDeviceAutoContorl, debug_stop_ims as debugStopIms,
 			delay_auto_control_start as delayAutoControlStart, package_version as packageVersion, schema_version as schemaVersion, nutrient_monitoring_interval as nutrientMonitoringInterval,
 			farm_nickname_i18n as farmNicknameI18n, user_id as userId, farm_db_id as farmDbId, category_id as categoryId
		FROM gsm_info 
		WHERE 
			gsm_key = #{gsmKey}
	</select>

	<select id="getGsmList" resultType="map" >
		/*getGsmList*/
		SELECT
			gsm_info.gsm_key as gsmKey, gsm_info.user_info_id as userInfoId, is_mine as isMine, area_code as areaCode,
 			farm_nickname as farmNickname, gsm_info.update_date as updateDate, owner_user_info_id as ownerUserInfoId, master_system_host as masterSystemHost,
 			master_system_port as masterSystemPort, system_host as systemHost, system_port as systemPort, cropsurl, imsurl,
 			mqtt_broker_host as mqttbrokerHost, mqtt_broker_port as mqttBrokerPort, server_read_time as serverReadTime, product_interval as productInterval,
 			monitoring_interval as monitoringInterval, history_save_db_interval as historySaveDbInterval, sensor_current_retention_period as sensorCurrentRetentionPeriod,
 			debug_stop_event as debugStopEvent, debug_stop_crops as debugStopCrops, debug_stop_device_auto_control as debugStopDeviceAutoContorl, debug_stop_ims as debugStopIms,
 			delay_auto_control_start as delayAutoControlStart, package_version as packageVersion, schema_version as schemaVersion, nutrient_monitoring_interval as nutrientMonitoringInterval,
 			farm_nickname_i18n as farmNicknameI18n, user_id as userId, farm_db_id as farmDbId, category_id as categoryId
		FROM gsm_info
		<where>
			<if test="gsmKey != null"> AND gsm_info.gsm_key = #{gsmKey}</if>
		</where>
	</select>

	<select id="getHouseList" resultType="houseEnvVO">
		/*getHouseList*/
		SELECT 
			id, product_method_id, green_house_type_id, house_name,
			latitude, longitude, description, build_date, last_update, addr_1,
			addr_2, zip, nutrient_common_id, change_gh, change_temperature,
			floor_space, house_horizontal, house_vertical, house_height,
			plant_spacing, crop_cnt, house_direction, select_temp_sensor,
			select_hum_sensor, green_house.gsm_key, house_name_i18n
		FROM green_house
		INNER JOIN gsm_info ON green_house.gsm_key = gsm_info.gsm_key
		WHERE green_house.gsm_key = #{gsmKey}
	</select>
</mapper>
